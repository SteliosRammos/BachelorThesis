---

  kernelspec:
    display_name: Python 3
    language: python
    name: python3
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.0'
      jupytext_version: 1.0.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Setup Notebook

```{python}
# Turn off autosave for cleaner version control with jupytext and enable autoreloading of modules before running code
# %autosave 0
# %load_ext autoreload
# %matplotlib notebook
# %autoreload 2
```

# Building Classifier Y


## Import Libraries

```{python}
import sys
import pandas as pd
import math

import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split

from src.func.data_func import import_data
from src.func.model_func import build_model
from src.func.model_func import get_metrics
from src.func.model_func import save_model
from src.func.model_func import load_model
```

## Building Classifier Y

```{python echo=TRUE}
X,_,y = import_data()

X_lab = X.loc[~y.isna(), :].values
y_lab = y[~y.isna()].values
X_unlab = X.loc[y.isna(), :].values

X_train, X_test, y_train, y_test = train_test_split(X_lab, y_lab, test_size=0.33, random_state=1, stratify = y_lab)
classifier_y, roc_score = build_model(X_train,y_train,'RandomForestClassifier')
```

```{python}
# Evaluate
predicted_y = classifier_y.predict(X_test)
predicted_proba_y = classifier_y.predict_proba(X_test)[:, 1]
get_metrics(predicted_y,predicted_proba_y, y_test)
```

```{python}
# Save model 
save_model(classifier_y, '/Users/steliosrammos/Documents/Education/Maastricht/DKE-Year3/BachelorThesis/bachelor_thesis/models/uncorrected_classifier_y')
```

```{python}
load_classifier_s = load_model('/Users/steliosrammos/Documents/Education/Maastricht/DKE-Year3/BachelorThesis/bachelor_thesis/models/classifier_y.sav')

load_classifier_s.score(X_test, s_test)
```

```{python}
np.count_nonzero(predicted_y)/predicted_y.shape[0]
predicted_y.mean(axis=0)
```

## Compute Correction Coefficient 

```{python}
classifier_s = load_model('/Users/steliosrammos/Documents/Education/Maastricht/DKE-Year3/BachelorThesis/bachelor_thesis/models/classifier_s.sav')
X,s,_ = import_data('numpy_array')

prob_predicted_s = classifier_s.predict_proba(X)

prob_s = s[s==1].shape[0]/s.shape[0]
corr_coeff = compute_corr_coef(prob_s, prob_predicted_s)

corr_coeff
```



