---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.0'
      jupytext_version: 1.0.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Experiments Titanic Dataset

```{python}
import pandas as pd
import numpy as np
from xgboost import XGBClassifier
from sklearn.model_selection import StratifiedKFold
from sklearn.metrics import roc_auc_score, average_precision_score, brier_score_loss
from sklearn.model_selection import train_test_split
```

```{python}
# Import data
base_path = '/Users/steliosrammos/Documents/Education/Maastricht/DKE-Year3/BachelorThesis/bachelor_thesis/'

# Select dataset
data = pd.read_csv(base_path+"data/external/parkinsons.data", sep=",")
data = data.drop('name', axis=1)
data.head()
```

```{python}
data.columns
```

```{python}
status = data['status']
data = data.drop('status', axis=1)
data['class'] = status
data.head()
```

```{python}
data.to_csv('/Users/steliosrammos/Documents/Education/Maastricht/DKE-Year3/BachelorThesis/bachelor_thesis/data/external/parkinson.csv', sep=';', index=False)
```

```{python}
data['class'].value_counts(True)
```

```{python}
data.shape
```

```{python}
data.describe()
```

# Unbiased Model

```{python}
roc_scores = []

X = data.iloc[:, :-1]
y = data.iloc[:, -1]

skf = StratifiedKFold(10)

for train_index, test_index in skf.split(X, y):
    
    X_train, X_test = X.iloc[train_index], X.iloc[test_index]
    y_train, y_test = y.iloc[train_index], y.iloc[test_index]
    
    classifier_s = XGBClassifier()
    classifier_s.fit(X_train, y_train)
    
    predicted_probas = classifier_s.predict_proba(X_test)[:, 1]

    roc_score = roc_auc_score(y_test, predicted_probas)
    roc_scores.append(roc_score)
    
print("ROC: {0:9.4f} \n".format(np.array(roc_score).mean()))
```

# Biased Model

```{python}
biased_data = data.copy()

got_go = pd.Series(np.ones(biased_data.shape[0]))
biased_data.insert(biased_data.shape[1]-1,value=got_go, column="got_go")
biased_data.head()
```

```{python}
biased_data.loc[(biased_data['MDVP:Fo(Hz)'] < 120), 'got_go'] = 0
biased_data.loc[(biased_data['MDVP:Fo(Hz)'] < 120), 'class'] = np.nan
```

```{python}
biased_data.shape
```

```{python}
biased_data.head()
```

```{python}
labeled = biased_data[~biased_data["class"].isna()]
unlabeled = biased_data[biased_data["class"].isna()]

print(labeled.shape[0])
print(unlabeled.shape[0])
```

```{python}
labeled.head()
```

```{python}
X_train = labeled.iloc[:, :-2]
y_train = labeled.iloc[:, -1]

roc_scores = []
pr_scores = []
brier_scores = []

classifier_s.fit(X_train, y_train)
predicted_probas = classifier_s.predict_proba(X_test)[:, 1]
predicted_labels = classifier_s.predict(X_test)

roc_score = roc_auc_score(y_test, predicted_probas)
pr_score = average_precision_score(y_test, predicted_labels)
brier_score = brier_score_loss(y_test, predicted_labels)

print("ROC: {0:9.4f} \n PR: {1:9.4f} \n Brier: {2:9.4f} \n".format(roc_score, pr_score, brier_score))
```

```{python}
biased_data.insert(train_data.shape[1] - 1, "weight", pd.Series())
biased_data.weight = 1
```

```{python}
biased_data.head()
```

```{python}
biased_data.to_csv(base_path+"data/external/biased_train_diabetes.csv", sep=";", index=False)
```

```{python}

```
